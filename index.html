<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lash Master Pro</title>
    <!-- React & ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel Standalone for JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom font for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* index.css content can be inlined here if any */
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.1.0/",
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
// Content from index.tsx starts here

import React from 'react';
import ReactDOM from 'react-dom/client'; // Import for React 18 createRoot

import { GoogleGenAI } from "https://esm.sh/@google/genai";

// Initialize the GoogleGenAI client
// IMPORTANT: API Key is now hardcoded.
let ai;
const apiKey = "AIzaSyDfSH-I3vv0v6uXmTfMnt1YtwTQQJmboQo"; // Your API Key

try {
    if (!apiKey) {
        throw new Error("API_KEY is not defined. Please ensure it is correctly set.");
    }
    ai = new GoogleGenAI({ apiKey: apiKey });
} catch (e) {
    console.error("Failed to initialize GoogleGenAI. API_KEY might be missing or invalid.", e);
    // AI features will not work if 'ai' is not initialized.
}

// Main App Component
function App() {
  const [currentPage, setCurrentPage] = React.useState('home'); // State to manage current page view

  // Tailwind CSS classes for consistent styling - UPDATED FOR MODERN DESIGN
  const navButtonClass = "px-6 py-3 rounded-full font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-md";
  const activeNavButtonClass = "bg-purple-700 text-white shadow-lg";
  const inactiveNavButtonClass = "bg-purple-100 text-purple-800 hover:bg-purple-200";

  // Render content based on the current page
  const renderPage = () => {
    switch (currentPage) {
      case 'lashTypes':
        return <LashTypes />;
      case 'learningModules':
        return <LearningModules />;
      case 'about':
        return <About />;
      default:
        return <Home />;
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50 font-inter text-gray-800 flex flex-col">
      {/* Header Section - IMPROVED DESIGN */}
      <header className="bg-white shadow-xl p-4 md:p-6 flex flex-col sm:flex-row items-center justify-between sticky top-0 z-10 rounded-b-3xl">
        <h1 className="text-4xl font-extrabold text-purple-800 mb-4 sm:mb-0 md:text-5xl">
          Lash Master Pro
        </h1>
        {/* Navigation - IMPROVED BUTTON STYLE */}
        <nav className="flex flex-wrap justify-center gap-4">
          <button
            onClick={() => setCurrentPage('home')}
            className={`${navButtonClass} ${currentPage === 'home' ? activeNavButtonClass : inactiveNavButtonClass}`}
          >
            Inicio
          </button>
          <button
            onClick={() => setCurrentPage('lashTypes')}
            className={`${navButtonClass} ${currentPage === 'lashTypes' ? activeNavButtonClass : inactiveNavButtonClass}`}
          >
            Tipos de Pestañas
          </button>
          <button
            onClick={() => setCurrentPage('learningModules')}
            className={`${navButtonClass} ${currentPage === 'learningModules' ? activeNavButtonClass : inactiveNavButtonClass}`}
          >
            Módulos de Aprendizaje
          </button>
          <button
            onClick={() => setCurrentPage('about')}
            className={`${navButtonClass} ${currentPage === 'about' ? activeNavButtonClass : inactiveNavButtonClass}`}
          >
            Acerca de
          </button>
        </nav>
      </header>

      {/* Main Content Area - IMPROVED SPACING AND SHADOW */}
      <main className="flex-grow p-6 sm:p-8 md:p-10">
        <div className="max-w-5xl mx-auto bg-white p-6 sm:p-8 md:p-10 rounded-3xl shadow-2xl border border-purple-200">
          {renderPage()}
        </div>
      </main>

      {/* Footer Section - IMPROVED DESIGN */}
      <footer className="bg-purple-900 text-white p-4 md:p-6 text-center mt-12 rounded-t-3xl shadow-inner">
        <p className="text-lg">&copy; 2024 Lash Master Pro. Todos los derechos reservados.</p>
      </footer>
    </div>
  );
}

// --- Helper function for Image Generation (Refactored for @google/genai SDK) ---
async function generateImageFromPrompt(promptText, altText, fallbackSize = "400x250", contextName = "General") {
    if (!ai) {
        console.error(`GoogleGenAI not initialized. Cannot generate image for ${contextName}.`);
        return `https://placehold.co/${fallbackSize}/FF0000/FFFFFF?text=ERROR_SDK_NO_INIT`;
    }

    const fullPrompt = `Fotorrealista, de alta calidad, fondo simple, sin texto. ${promptText}`;
    try {
        console.log(`[${contextName}] Generating image with prompt: "${fullPrompt.substring(0,100)}..."`);
        const response = await ai.models.generateImages({
            model: 'imagen-3.0-generate-002',
            prompt: fullPrompt,
            config: { numberOfImages: 1, outputMimeType: 'image/png' },
        });

        if (response.generatedImages && response.generatedImages.length > 0 && response.generatedImages[0].image && response.generatedImages[0].image.imageBytes) {
            console.log(`[${contextName}] Image generated successfully.`);
            const base64ImageBytes = response.generatedImages[0].image.imageBytes;
            return `data:image/png;base64,${base64ImageBytes}`;
        } else {
            console.error(`[${contextName}] No image data found in SDK response. Response:`, response);
            return `https://placehold.co/${fallbackSize}/FFBF00/FFFFFF?text=NO_IMG_DATA_RESP`;
        }
    } catch (error) {
        console.error(`[${contextName}] Error generating image using SDK:`, error);
        let errorMessage = "FALLA_API_GENERACION"; // Default error for image generation API failure
        if (error.message) {
            const lowerErrorMessage = error.message.toLowerCase();
            if (lowerErrorMessage.includes("api key not valid")) {
                errorMessage = "ERROR_CLAVE_API";
            } else if (lowerErrorMessage.includes("quota")) {
                errorMessage = "ERROR_CUOTA_API";
            } else if (lowerErrorMessage.includes("resource has been exhausted")) {
                errorMessage = "ERROR_RECURSOS_AGOTADOS"; // Often quota related
            } else if (lowerErrorMessage.includes("service unavailable")) {
                errorMessage = "ERROR_SERVICIO_NO_DISPONIBLE";
            } else if (lowerErrorMessage.includes("billing") || lowerErrorMessage.includes("billed users")) {
                errorMessage = "ERROR_FACTURACION";
            }
        }
        return `https://placehold.co/${fallbackSize}/FF0000/FFFFFF?text=${errorMessage}`;
    }
}


// Home Page Component
function Home() {
  const [generatedImageUrl, setGeneratedImageUrl] = React.useState('');
  const [isLoadingImage, setIsLoadingImage] = React.useState(true);

  React.useEffect(() => {
    const prompt = "Esteticista profesional sonriente y alegre, con guantes, aplicando meticulosamente extensiones de pestañas a una clienta joven también sonriente y satisfecha. Ambas miran a la cámara con expresiones de felicidad. La escena es un salón de belleza moderno y limpio, con iluminación suave y cálida. Enfoque nítido en las pestañas y las manos del profesional. Colores vibrantes y realistas.";
    generateImageFromPrompt(prompt, "Bienvenida al Mundo de las Pestañas", "600x400", "Home Page")
        .then(url => setGeneratedImageUrl(url))
        .finally(() => setIsLoadingImage(false));
  }, []);

  return (
    <div className="text-center py-8">
      <h2 className="text-4xl font-bold text-purple-700 mb-6">¡Bienvenida a Lash Master Pro!</h2>
      <p className="text-lg leading-relaxed mb-6">
        Tu guía completa para dominar el arte de las extensiones de pestañas. Explora nuestros módulos de aprendizaje,
        descubre los diferentes tipos de pestañas y mejora tus habilidades.
      </p>
      <div className="flex justify-center mb-6">
        {isLoadingImage ? (
          <div className="w-full max-w-lg h-64 flex items-center justify-center bg-gray-200 rounded-2xl shadow-lg">
            <svg className="animate-spin h-10 w-10 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
        ) : (
          <img
            src={generatedImageUrl}
            alt="[Image of Esteticista Aplicando Pestañas]"
            className="rounded-2xl shadow-xl w-full max-w-lg h-64 object-cover mx-auto transform hover:scale-102 transition-transform duration-300"
            onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/600x400/FF0000/FFFFFF?text=IMAGEN_ERROR_ONERROR`; }}
          />
        )}
      </div>
      <p className="text-md mt-6 text-gray-600">
        ¡Comienza tu viaje hoy mismo! Navega por las secciones de arriba para empezar.
      </p>
    </div>
  );
}

// Lash Types Page Component
function LashTypes() {
  const [classicImage, setClassicImage] = React.useState('');
  const [loadingClassic, setLoadingClassic] = React.useState(true);
  const [volumeImage, setVolumeImage] = React.useState('');
  const [loadingVolume, setLoadingVolume] = React.useState(true);
  const [hybridImage, setHybridImage] = React.useState('');
  const [loadingHybrid, setLoadingHybrid] = React.useState(true);
  const [megaVolumeImage, setMegaVolumeImage] = React.useState('');
  const [loadingMegaVolume, setLoadingMegaVolume] = React.useState(true);
  const [lashLiftImage, setLashLiftImage] = React.useState('');
  const [loadingLashLift, setLoadingLashLift] = React.useState(true);

  React.useEffect(() => {
    const loadImages = async () => {
      setClassicImage(await generateImageFromPrompt("Primer plano extremo fotorrealista de un ojo con extensiones de pestañas clásicas perfectamente aplicadas. Cada extensión individual está meticulosamente adherida a una pestaña natural, creando un efecto de alargamiento natural. Fondo liso y difuminado. Colores realistas.", "Pestañas Clásicas", "300x200", "Pestañas Clásicas"));
      setLoadingClassic(false);
      await new Promise(resolve => setTimeout(resolve, 500)); // Stagger API calls

      setVolumeImage(await generateImageFromPrompt("Primer plano extremo fotorrealista de un ojo con extensiones de pestañas de volumen (abanicos 4D-6D) perfectamente aplicadas. Los abanicos densos y mullidos se ven claramente, creando un efecto de alto volumen y dramatismo. Fondo liso y difuminado. Colores realistas.", "Pestañas Volumen", "300x200", "Pestañas Volumen"));
      setLoadingVolume(false);
      await new Promise(resolve => setTimeout(resolve, 500));

      setHybridImage(await generateImageFromPrompt("Primer plano extremo fotorrealista de un ojo con extensiones de pestañas híbridas, mostrando una mezcla equilibrada de extensiones individuales (clásicas) y abanicos de volumen. La textura y la densidad son claramente visibles. Fondo liso y difuminado. Colores realistas.", "Pestañas Híbridas", "300x200", "Pestañas Híbridas"));
      setLoadingHybrid(false);
      await new Promise(resolve => setTimeout(resolve, 500));

      setMegaVolumeImage(await generateImageFromPrompt("Primer plano extremo fotorrealista de un ojo con extensiones de pestañas de mega volumen (abanicos 10D-15D) perfectamente aplicadas. El efecto es de máxima densidad y un look glamuroso y oscuro. Fondo liso y difuminado. Colores realistas.", "Pestañas Mega Volumen", "300x200", "Pestañas Mega Volumen"));
      setLoadingMegaVolume(false);
      await new Promise(resolve => setTimeout(resolve, 500));

      setLashLiftImage(await generateImageFromPrompt("Primer plano extremo fotorrealista de un ojo con pestañas naturales después de un levantamiento (lash lift). Las pestañas están perfectamente curvadas hacia arriba desde la raíz, dando un aspecto de ojo abierto y alargado natural. Sin extensiones. Fondo liso y difuminado. Colores realistas.", "Levantamiento Pestañas", "300x200", "Levantamiento de Pestañas"));
      setLoadingLashLift(false);
    };
    loadImages();
  }, []);

  const lashTypes = [
    { name: "Pestañas Clásicas", description: "Las extensiones clásicas consisten en aplicar una extensión individual a una pestaña natural...", image: classicImage, isLoading: loadingClassic, details: ["Relación 1:1", "Ideal para look natural", "Duración: 2-3 semanas"] },
    { name: "Pestañas de Volumen (2D-6D)", description: "Las extensiones de volumen... implican la creación de 'abanicos'...", image: volumeImage, isLoading: loadingVolume, details: ["Abanicos 2D-6D", "Look más lleno y dramático", "Duración: 3-4 semanas"] },
    { name: "Pestañas Híbridas", description: "Las pestañas híbridas son una combinación de extensiones clásicas y de volumen...", image: hybridImage, isLoading: loadingHybrid, details: ["Mezcla de clásicas y volumen", "Aspecto texturizado", "Duración: 3-4 semanas"] },
    { name: "Pestañas Mega Volumen (7D+)", description: "El mega volumen... utilizando abanicos aún más grandes (7D o más)...", image: megaVolumeImage, isLoading: loadingMegaVolume, details: ["Abanicos 7D+", "Look ultra-dramático", "Duración: 4-5 semanas"] },
    { name: "Levantamiento de Pestañas (Lash Lift)", description: "No es una extensión, sino un tratamiento que riza y levanta las pestañas naturales...", image: lashLiftImage, isLoading: loadingLashLift, details: ["Tratamiento para pestañas naturales", "Rizado y levantamiento", "Duración: 6-8 semanas"] }
  ];

  const [eyeShape, setEyeShape] = React.useState('');
  const [desiredLook, setDesiredLook] = React.useState('');
  const [occasion, setOccasion] = React.useState('');
  const [lashSuggestion, setLashSuggestion] = React.useState('');
  const [loadingSuggestion, setLoadingSuggestion] = React.useState(false);

  const [clientDescription, setClientDescription] = React.useState('');
  const [clientAnalysis, setClientAnalysis] = React.useState('');
  const [loadingAnalysis, setLoadingAnalysis] = React.useState(false);

  const [marketingLashType, setMarketingLashType] = React.useState('');
  const [marketingKeywords, setMarketingKeywords] = React.useState('');
  const [generatedMarketingText, setGeneratedMarketingText] = React.useState('');
  const [loadingMarketingText, setLoadingMarketingText] = React.useState(false);

  const geminiTextCall = async (prompt, setLoading, setResult, errorContext) => {
    if (!ai) {
      console.error(`[${errorContext}] GoogleGenAI not initialized. Cannot process request.`);
      setResult(`Error: El servicio de IA no está disponible (SDK no inicializado).`);
      return;
    }
    setLoading(true);
    setResult('');
    try {
      console.log(`[${errorContext}] Calling Gemini text API with prompt: "${prompt.substring(0,100)}..."`);
      const response = await ai.models.generateContent({
        model: 'gemini-2.5-flash-preview-04-17',
        contents: prompt,
      });
      console.log(`[${errorContext}] Gemini text API response received.`);
      setResult(response.text);
    } catch (error) {
      console.error(`[${errorContext}] Error using SDK for text generation:`, error);
      let userErrorMessage = `Error al conectar con la IA. Inténtalo de nuevo.`;
      if (error.message) {
          if (error.message.toLowerCase().includes("api key not valid")) {
              userErrorMessage = "Error: La clave de API no es válida o no está configurada correctamente.";
          } else if (error.message.toLowerCase().includes("quota")) {
              userErrorMessage = "Error: Se ha alcanzado la cuota de la API.";
          } else if (error.message.toLowerCase().includes("billing") || error.message.toLowerCase().includes("billed users")) {
              userErrorMessage = "Error: Problema de facturación con la API. Asegúrate de que la facturación esté habilitada.";
          }
      }
      setResult(userErrorMessage);
    } finally {
      setLoading(false);
    }
  };

  const handleSuggestLashCombination = async () => {
    if (!eyeShape || !desiredLook || !occasion) {
      setLashSuggestion('Por favor, selecciona la forma de ojo, el aspecto deseado y la ocasión.');
      return;
    }
    const prompt = `Sugiere la mejor combinación de tipos de extensiones de pestañas (Clásicas, Volumen, Híbridas, Mega Volumen, Levantamiento de Pestañas) para una persona con forma de ojo "${eyeShape}" que busca un aspecto "${desiredLook}" para la ocasión "${occasion}". Sé conciso y menciona 2-3 opciones si es posible, explicando brevemente por qué.`;
    geminiTextCall(prompt, setLoadingSuggestion, setLashSuggestion, "LashTypes - Sugerencia Combinación");
  };

  const handleAnalyzeClient = async () => {
    if (!clientDescription.trim()) {
      setClientAnalysis('Por favor, introduce una descripción del cliente para el análisis.');
      return;
    }
    const prompt = `Basado en la siguiente descripción del cliente para extensiones de pestañas, proporciona una sugerencia útil sobre los estilos de pestañas más adecuados (Clásicas, Volumen, Híbridas, Mega Volumen, Levantamiento de Pestañas). Si la información es limitada, haz inferencias razonables o sugiere opciones versátiles, explicando brevemente tu razonamiento y considerando el look deseado y el estilo de vida del cliente. Descripción: "${clientDescription}"`;
    geminiTextCall(prompt, setLoadingAnalysis, setClientAnalysis, "LashTypes - Análisis Cliente");
  };

  const handleGenerateMarketingText = async () => {
    if (!marketingLashType || !marketingKeywords.trim()) {
      setGeneratedMarketingText('Por favor, selecciona un tipo de pestaña y describe el tono/palabras clave.');
      return;
    }
    const prompt = `Genera un texto de marketing o una descripción corta para redes sociales (máximo 50 palabras) para el tipo de pestañas "${marketingLashType}". El tono o las palabras clave son: "${marketingKeywords}". Incluye hashtags relevantes.`;
    geminiTextCall(prompt, setLoadingMarketingText, setGeneratedMarketingText, "LashTypes - Texto Marketing");
  };

  return (
    <div className="py-8">
      <h2 className="text-3xl font-bold text-purple-700 mb-8 text-center">Tipos de Pestañas</h2>
      
      <div className="bg-purple-50 rounded-xl shadow-lg p-6 mb-8 border border-purple-200">
        <h3 className="text-2xl font-semibold text-purple-700 mb-4 text-center">Sugerencia Personalizada de Pestañas ✨</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div>
            <label htmlFor="eyeShape" className="block text-gray-700 text-sm font-bold mb-2">Forma de Ojo:</label>
            <select id="eyeShape" value={eyeShape} onChange={(e) => setEyeShape(e.target.value)} className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-purple-500">
              <option value="">Selecciona una forma</option>
              <option value="Almendrada">Almendrada</option>
              <option value="Redonda">Redonda</option>
              <option value="Monólido">Monólido</option>
              <option value="Encappuchados">Encappuchados</option>
              <option value="Caídos">Caídos</option>
            </select>
          </div>
          <div>
            <label htmlFor="desiredLook" className="block text-gray-700 text-sm font-bold mb-2">Aspecto Deseado:</label>
            <select id="desiredLook" value={desiredLook} onChange={(e) => setDesiredLook(e.target.value)} className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-purple-500">
              <option value="">Selecciona un aspecto</option>
              <option value="Natural Suave">Natural Suave</option>
              <option value="Volumen Sutil">Volumen Sutil</option>
              <option value="Dramático y Extenso">Dramático y Extenso</option>
            </select>
          </div>
          <div>
            <label htmlFor="occasion" className="block text-gray-700 text-sm font-bold mb-2">Ocasión:</label>
            <select id="occasion" value={occasion} onChange={(e) => setOccasion(e.target.value)} className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-purple-500">
              <option value="">Selecciona una ocasión</option>
              <option value="Diario">Diario</option>
              <option value="Fiesta">Fiesta</option>
              <option value="Boda">Boda</option>
            </select>
          </div>
        </div>
        <button onClick={handleSuggestLashCombination} className="w-full bg-indigo-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-indigo-600 transition-colors duration-200 shadow-md flex items-center justify-center" disabled={loadingSuggestion}>
          {loadingSuggestion ? <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : 'Sugerir Combinación ✨'}
        </button>
        {lashSuggestion && <div className="mt-4 p-4 bg-white rounded-lg border border-indigo-300 text-indigo-800 text-sm italic"><strong>Sugerencia IA:</strong> {lashSuggestion}</div>}
      </div>

      <div className="bg-purple-50 rounded-xl shadow-lg p-6 mb-8 border border-purple-200">
        <h3 className="text-2xl font-semibold text-purple-700 mb-4 text-center">Análisis de Cliente con IA ✨</h3>
        <textarea className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400 mb-4 resize-y" rows="4" placeholder="Describe a tu cliente..." value={clientDescription} onChange={(e) => setClientDescription(e.target.value)}></textarea>
        <button onClick={handleAnalyzeClient} className="w-full bg-green-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-600 transition-colors duration-200 shadow-md flex items-center justify-center" disabled={loadingAnalysis}>
          {loadingAnalysis ? <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : 'Analizar Cliente ✨'}
        </button>
        {clientAnalysis && <div className="mt-4 p-4 bg-white rounded-lg border border-green-300 text-green-800 text-sm italic"><strong>Análisis IA:</strong> {clientAnalysis}</div>}
      </div>

      <div className="bg-purple-50 rounded-xl shadow-lg p-6 mb-8 border border-purple-200">
        <h3 className="text-2xl font-semibold text-purple-700 mb-4 text-center">Generador de Contenido de Marketing ✨</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label htmlFor="marketingLashType" className="block text-gray-700 text-sm font-bold mb-2">Tipo de Pestaña:</label>
            <select id="marketingLashType" value={marketingLashType} onChange={(e) => setMarketingLashType(e.target.value)} className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700">
              <option value="">Selecciona un tipo</option>
              {lashTypes.map(lt => lt.name !== "Levantamiento de Pestañas (Lash Lift)" && <option key={lt.name} value={lt.name}>{lt.name}</option>)}
               <option value="Levantamiento de Pestañas">Levantamiento de Pestañas</option>
            </select>
          </div>
          <div>
            <label htmlFor="marketingKeywords" className="block text-gray-700 text-sm font-bold mb-2">Tono / Palabras Clave:</label>
            <input type="text" id="marketingKeywords" className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" placeholder="Ej: elegante, natural" value={marketingKeywords} onChange={(e) => setMarketingKeywords(e.target.value)} />
          </div>
        </div>
        <button onClick={handleGenerateMarketingText} className="w-full bg-blue-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-600 transition-colors duration-200 shadow-md flex items-center justify-center" disabled={loadingMarketingText}>
          {loadingMarketingText ? <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : 'Generar Texto Marketing ✨'}
        </button>
        {generatedMarketingText && <div className="mt-4 p-4 bg-white rounded-lg border border-blue-300 text-blue-800 text-sm italic"><strong>Texto Generado:</strong> {generatedMarketingText}</div>}
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
        {lashTypes.map((type, index) => (
          <div key={index} className="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center border border-purple-200 transform hover:scale-105 transition-transform duration-300">
            {type.isLoading ? (
              <div className="w-full h-48 flex items-center justify-center bg-gray-100 rounded-md mb-4 shadow-sm">
                <svg className="animate-spin h-8 w-8 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
            ) : (
              <img src={type.image} alt={`[Imagen de ${type.name}]`} className="w-full h-48 object-cover rounded-md mb-4 shadow-md" onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/300x200/FF0000/FFFFFF?text=IMAGEN_ERROR_ONERROR`; }}/>
            )}
            <h3 className="text-2xl font-semibold text-purple-600 mb-3">{type.name}</h3>
            <p className="text-gray-700 text-center mb-4 leading-relaxed">{type.description}</p>
            <ul className="text-gray-600 text-left w-full list-disc list-inside">
              {type.details.map((detail, dIndex) => <li key={dIndex}>{detail}</li>)}
            </ul>
          </div>
        ))}
      </div>
    </div>
  );
}

function LearningSection({ moduleIndex, sectionIndex, section, generatedTips, setLoadingTips, setGeneratedTips, loadingTips, geminiTextCall }) {
  const [generatedSectionImageUrl, setGeneratedSectionImageUrl] = React.useState('');
  const [isLoadingSectionImage, setIsLoadingSectionImage] = React.useState(true);
  const [question, setQuestion] = React.useState('');
  const [answer, setAnswer] = React.useState('');
  const [loadingAnswer, setLoadingAnswer] = React.useState(false);
  
  const sectionKey = `${moduleIndex}-${sectionIndex}`;
  const sectionContextName = `Módulo ${moduleIndex + 1} Sección ${sectionIndex + 1} (${section.name})`;


  React.useEffect(() => {
    const getImagePrompt = (sectionName) => {
        // Prompts from original code
        switch (sectionName) {
            case "1.1 Anatomía y Ciclo de la Pestaña": return "Ilustración fotorrealista y muy detallada de un ojo humano, con un enfoque claro en las pestañas naturales...";
            case "1.2 Higiene y Seguridad": return "Imagen fotorrealista de primer plano de manos con guantes estériles de un técnico de pestañas...";
            // Add more specific prompts here from your original design if available
            // For example:
            case "1.3 Herramientas y Materiales Esenciales": return "Bodegón fotorrealista bien iluminado mostrando varias herramientas para extensiones de pestañas: pinzas de aislamiento, pinzas de aplicación, adhesivo para pestañas, parches de gel, microcepillos, y una paleta de pestañas. Fondo limpio y profesional.";
            case "2.1 Preparación del Cliente": return "Vista superior fotorrealista de la zona de los ojos de un cliente, con las pestañas limpias y preparadas para la aplicación de extensiones. Se pueden ver parches de gel debajo de los ojos. Iluminación de estudio.";
            case "2.2 Técnicas de Aislamiento": return "Macro fotorrealista extrema de una pinza de aislamiento separando cuidadosamente una pestaña natural de las demás, lista para la aplicación de una extensión. Enfoque nítido en la punta de la pinza y la pestaña aislada.";
            case "2.3 Aplicación 1:1 y Adhesión": return "Primer plano extremo fotorrealista de una extensión de pestaña clásica siendo aplicada a una pestaña natural aislada. Se puede ver una microgota de adhesivo. Enfoque en el punto de unión.";
            case "3.1 Mapeo de Pestañas": return "Dibujo o ilustración digital clara sobre una foto de un ojo cerrado, mostrando líneas y números que indican diferentes longitudes de pestañas para un diseño de 'ojo de gato' o 'muñeca'. Estilo limpio y educativo.";
            case "3.2 Curvaturas y Grosores": return "Comparación visual fotorrealista lado a lado de diferentes curvaturas de extensiones de pestañas (J, B, C, D, L) y diferentes grosores (0.07mm, 0.10mm, 0.15mm) sobre un fondo neutro.";
            case "4.1 Cuidado Post-Aplicación": return "Mujer sonriente con extensiones de pestañas perfectas, cepillando suavemente sus pestañas con un cepillo tipo spoolie. Fondo de un baño limpio y luminoso.";
            case "4.2 Rellenos y Retirada": return "Vista de primer plano fotorrealista de un técnico de pestañas aplicando cuidadosamente extensiones en un relleno, o utilizando un removedor de gel para quitar extensiones de forma segura. El enfoque debe ser profesional y seguro.";
            default: return `Imagen realista y de alta calidad que representa el concepto de "${sectionName}" relacionado con las extensiones de pestañas y su aprendizaje.`;
        }
    };
    generateImageFromPrompt(getImagePrompt(section.name), `Imagen de ${section.name}`, "350x200", sectionContextName)
        .then(url => setGeneratedSectionImageUrl(url))
        .finally(() => setIsLoadingSectionImage(false));
  }, [section.name, moduleIndex, sectionIndex]);

  const generateLashTip = () => {
    const prompt = `Dado el siguiente contenido sobre extensiones de pestañas ("${section.content}"), genera un consejo práctico para un principiante en una frase corta y concisa (máximo 20 palabras) que pueda integrarse directamente en el texto del módulo.`;
    geminiTextCall(prompt, 
      (isLoading) => setLoadingTips(prev => ({ ...prev, [sectionKey]: isLoading })),
      (tip) => setGeneratedTips(prev => ({ ...prev, [sectionKey]: tip })),
      `${sectionContextName} - Consejo IA`
    );
  };

  const handleAskQuestion = () => {
    if (!question.trim()) {
      setAnswer("Por favor, escribe una pregunta para obtener una respuesta.");
      return;
    }
    const prompt = `Basado en el siguiente contenido sobre extensiones de pestañas y técnicas ("${section.content}"), responde a la pregunta del estudiante: "${question}". Si la pregunta no está directamente relacionada, indica amablemente que no tienes información específica sobre ese tema en este contexto.`;
    geminiTextCall(prompt, setLoadingAnswer, setAnswer, `${sectionContextName} - Pregunta IA`);
  };

  return (
    <div className="bg-white rounded-lg p-5 shadow-sm border border-gray-200">
      <h4 className="text-xl font-medium text-purple-600 mb-3">{section.name}</h4>
      <p className="text-gray-700 mb-4">{section.content}</p>

      {generatedTips[sectionKey] && (
        <div className="mt-4 p-3 bg-purple-100 rounded-lg border border-purple-300 text-purple-800 text-sm italic">
          <h5 className="font-semibold text-purple-700 mb-2">Consejo de la IA:</h5>
          <p>{generatedTips[sectionKey]}</p>
        </div>
      )}

      {section.videoLink && <p className="text-blue-600 hover:underline mb-4"><a href={section.videoLink} target="_blank" rel="noopener noreferrer">Ver Video (Ejemplo)</a></p>}

      {isLoadingSectionImage ? (
         <div className="mt-4 w-full h-48 flex items-center justify-center bg-gray-100 rounded-md shadow-sm"> <svg className="animate-spin h-8 w-8 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>
      ) : (
        <img src={generatedSectionImageUrl} alt={`[Imagen de ${section.name}]`} className="mt-4 w-full rounded-md shadow-sm object-cover h-48" onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/350x200/FF0000/FFFFFF?text=IMAGEN_ERROR_ONERROR`; }}/>
      )}

      <button onClick={generateLashTip} className="mt-4 w-full bg-pink-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-pink-600" disabled={loadingTips[sectionKey]}>
        {loadingTips[sectionKey] ? <svg className="animate-spin h-5 w-5 mr-3 text-white" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : 'Generar Nuevo Consejo ✨'}
      </button>

      <div className="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <h5 className="text-xl font-semibold text-gray-700 mb-3 text-center">Pregúntale a la IA ✨</h5>
        <textarea className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 mb-3 resize-y" rows="2" placeholder="Ej: ¿Cuál es la diferencia entre fase anágena y telógena?" value={question} onChange={(e) => setQuestion(e.target.value)}></textarea>
        <button onClick={handleAskQuestion} className="w-full bg-purple-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-600" disabled={loadingAnswer}>
          {loadingAnswer ? <svg className="animate-spin h-5 w-5 mr-3 text-white" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : 'Obtener Respuesta IA ✨'}
        </button>
        {answer && <div className="mt-3 p-3 bg-white rounded-lg border border-purple-200 text-purple-700 text-sm italic"><strong>Respuesta IA:</strong> {answer}</div>}
      </div>
    </div>
  );
}

function LearningModules() {
  const modules = [
    { title: "Módulo 1: Fundamentos", description: "Anatomía, higiene, materiales.", image: "https://placehold.co/100x100/93c5fd/ffffff?text=M1", sections: [
        { name: "1.1 Anatomía y Ciclo de la Pestaña", content: "Explora la estructura de la pestaña natural y su ciclo de crecimiento (anágena, catágena, telógena). Aprende sobre la importancia de la salud de las pestañas naturales para una aplicación exitosa y duradera. Factores que afectan el crecimiento.", videoLink: "#" },
        { name: "1.2 Higiene y Seguridad", content: "Protocolos de limpieza y desinfección de herramientas y el área de trabajo. Prácticas de higiene personal del técnico. Identificación y manejo de posibles reacciones alérgicas o sensibilidades. Importancia de los parches de prueba.", videoLink: "#" },
        { name: "1.3 Herramientas y Materiales Esenciales", content: "Descubre los diferentes tipos de pinzas (aislamiento, aplicación), adhesivos (tipos, curado, almacenamiento), extensiones (materiales, curvaturas, grosores, longitudes), primers, selladores, removedores, parches de gel, cintas, y otros accesorios.", videoLink: "#" }
    ]},
    { title: "Módulo 2: Aplicación Clásica", description: "Domina la técnica 1:1.", image: "https://placehold.co/100x100/bfdbfe/ffffff?text=M2", sections: [
        { name: "2.1 Preparación del Cliente", content: "Consulta inicial con el cliente, discusión de expectativas y contraindicaciones. Limpieza profunda de las pestañas naturales. Aplicación correcta de parches de gel y cinta para proteger las pestañas inferiores.", videoLink: "#" },
        { name: "2.2 Técnicas de Aislamiento", content: "La importancia del aislamiento perfecto de una única pestaña natural antes de aplicar la extensión. Diferentes métodos de aislamiento con pinzas. Cómo evitar pegar múltiples pestañas naturales (stickies).", videoLink: "#" },
        { name: "2.3 Aplicación 1:1 y Adhesión", content: "Guía paso a paso para aplicar una extensión clásica a una pestaña natural. Correcta inmersión de la extensión en el adhesivo. Distancia de aplicación desde el párpado. Asegurar una buena base de unión para máxima retención.", videoLink: "#" }
    ]},
    { title: "Módulo 3: Diseño y Estilismo", description: "Personalizar sets para diferentes ojos.", image: "https://placehold.co/100x100/dbeafe/ffffff?text=M3", sections: [
        { name: "3.1 Mapeo de Pestañas", content: "Técnicas de mapeo para crear diferentes estilos (natural, ojo de gato, muñeca, ardilla, etc.). Cómo adaptar el diseño a la forma del ojo del cliente (almendrados, redondos, caídos, encapuchados) y a la dirección de crecimiento de las pestañas naturales.", videoLink: "#" },
        { name: "3.2 Curvaturas y Grosores", content: "Selección de curvaturas (J, B, C, CC, D, L, M) y grosores (ej. 0.10, 0.15, 0.18, 0.20 para clásicas) adecuados según el efecto deseado y la salud de las pestañas naturales del cliente. Combinación de diferentes curvaturas y longitudes.", videoLink: "#" }
    ]},
    { title: "Módulo 4: Cuidado y Mantenimiento", description: "Cuidado posterior, rellenos, retiradas.", image: "https://placehold.co/100x100/eff6ff/ffffff?text=M4", sections: [
        { name: "4.1 Cuidado Post-Aplicación", content: "Consejos para el cliente sobre cómo cuidar sus extensiones para maximizar la retención: limpieza diaria, evitar productos oleosos, no frotar los ojos, cepillado. Productos de cuidado posterior recomendados.", videoLink: "#" },
        { name: "4.2 Rellenos y Retirada", content: "Técnicas para realizar rellenos de forma efectiva: eliminar extensiones crecidas, limpiar y preparar para nuevas aplicaciones. Proceso seguro para la retirada completa de extensiones utilizando removedores profesionales.", videoLink: "#" }
    ]}
  ];

  const [expandedModule, setExpandedModule] = React.useState(null);
  const [generatedTips, setGeneratedTips] = React.useState({});
  const [loadingTips, setLoadingTips] = React.useState({});

  const toggleModule = (index) => setExpandedModule(expandedModule === index ? null : index);

  // Re-use geminiTextCall from LashTypes or define it here if preferred
  const geminiTextCall = async (prompt, setLoading, setResult, errorContext) => {
    if (!ai) {
      console.error(`[${errorContext}] GoogleGenAI not initialized. Cannot process request.`);
      if (typeof setResult === 'function') {
        setResult(`Error: El servicio de IA no está disponible.`); 
      }
      if (typeof setLoading === 'function') {
        // Attempt to set loading to false, adapting to object-based setters
        try {
            if (setLoading.length === 1 && typeof setLoading(false) === 'object' && Object.keys(setLoading(false)).length > 0 ) {
                 // This is for setters like setLoadingTips(prev => ({ ...prev, [sectionKey]: isLoading }))
                 // We don't know the key here, so this specific path is hard to manage perfectly from a generic function
                 // Best to ensure individual loading states are managed or reset if call fails early
            } else {
                 setLoading(false); 
            }
        } catch(e) { /* silent */ }
      }
      return;
    }
  
    if (typeof setLoading === 'function') {
      try { setLoading(true); } catch(e) { /* silent */ }
    }
  
    if (typeof setResult === 'function') {
        setResult(''); 
    }

    try {
      console.log(`[${errorContext}] Calling Gemini text API with prompt: "${prompt.substring(0,100)}..."`);
      const response = await ai.models.generateContent({
        model: 'gemini-2.5-flash-preview-04-17',
        contents: prompt,
      });
      console.log(`[${errorContext}] Gemini text API response received.`);
      if (typeof setResult === 'function') {
        setResult(response.text);
      }
    } catch (error) {
      console.error(`[${errorContext}] Error using SDK for text generation:`, error);
      let userErrorMessage = `Error al conectar con la IA. Verifique su conexión o la configuración de la API.`;
       if (error.message) {
          const lowerErrorMessage = error.message.toLowerCase();
          if (lowerErrorMessage.includes("api key not valid")) {
              userErrorMessage = "Error: La clave de API no es válida o no está configurada correctamente.";
          } else if (lowerErrorMessage.includes("quota")) {
              userErrorMessage = "Error: Se ha alcanzado la cuota de la API.";
          } else if (lowerErrorMessage.includes("billing") || lowerErrorMessage.includes("billed users")) {
              userErrorMessage = "Error: Problema de facturación con la API. Asegúrate de que la facturación esté habilitada.";
          }
      }
      if (typeof setResult === 'function') {
        setResult(userErrorMessage);
      }
    } finally {
      if (typeof setLoading === 'function') {
         try { setLoading(false); } catch(e) { /* silent */ }
      }
    }
  };


  return (
    <div className="py-8">
      <h2 className="text-3xl font-bold text-purple-700 mb-8 text-center">Módulos de Aprendizaje</h2>
      <div className="space-y-6">
        {modules.map((module, mIndex) => (
          <div key={mIndex} className="bg-white rounded-xl shadow-lg p-6 border border-purple-200 transform hover:scale-105 transition-transform duration-300">
            <button className="w-full text-left p-6 flex flex-col sm:flex-row items-center justify-between bg-purple-50 hover:bg-purple-100 rounded-lg" onClick={() => toggleModule(mIndex)}>
              <img src={module.image} alt={module.title} className="w-24 h-24 object-cover rounded-full mb-4 sm:mb-0 sm:mr-6 shadow-md" onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/100x100/CCCCCC/ffffff?text=Error`; }}/>
              <div className="flex-1">
                <h3 className="text-2xl font-semibold text-purple-700 mb-2">{module.title}</h3>
                <p className="text-gray-600">{module.description}</p>
              </div>
              <span className="text-purple-600 text-2xl ml-4 transition-transform duration-300 transform" style={{ transform: expandedModule === mIndex ? 'rotate(180deg)' : 'rotate(0deg)' }}>▼</span>
            </button>
            {expandedModule === mIndex && (
              <div className="p-6 bg-purple-50 border-t border-purple-200 mt-4 rounded-b-lg">
                <div className="space-y-6">
                  {module.sections.map((section, sIndex) => (
                    <LearningSection
                      key={sIndex}
                      moduleIndex={mIndex}
                      sectionIndex={sIndex}
                      section={section}
                      generatedTips={generatedTips}
                      setLoadingTips={setLoadingTips} 
                      setGeneratedTips={setGeneratedTips} 
                      loadingTips={loadingTips} 
                      geminiTextCall={geminiTextCall} 
                    />
                  ))}
                </div>
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  );
}

function About() {
  return (
    <div className="py-8 text-center">
      <h2 className="text-3xl font-bold text-purple-700 mb-6">Acerca de Lash Master Pro</h2>
      <p className="text-lg leading-relaxed mb-4">
        Lash Master Pro es una plataforma interactiva y educativa diseñada para empoderar a los artistas de pestañas, desde principiantes hasta expertos. 
        Nuestra misión es proporcionar conocimientos fundamentales, técnicas avanzadas y herramientas de IA para perfeccionar el arte de las extensiones de pestañas.
        Creemos en el aprendizaje continuo y en la adaptación a las últimas tendencias de la industria.
      </p>
      <p className="text-lg leading-relaxed mb-4">
        Explora nuestros módulos de aprendizaje detallados, utiliza nuestras herramientas de IA para obtener sugerencias personalizadas, analizar las necesidades de tus clientes,
        y generar contenido de marketing atractivo. ¡Conviértete en un verdadero Lash Master Pro!
      </p>
      <img src="https://placehold.co/500x300/a78bfa/ffffff?text=Equipo+Lash+Master+Pro" alt="[Image of Equipo Lash Master Pro]" className="mt-8 mx-auto rounded-xl shadow-md w-full max-w-lg" onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/500x300/FF0000/FFFFFF?text=IMAGEN_ERROR_ONERROR'; }}/>
    </div>
  );
}

// Use createRoot for React 18
const container = document.getElementById('root');
const root = ReactDOM.createRoot(container);
root.render(<App />);

// Content from index.tsx ends here
    </script>
</body>
</html>
